generator client {
	provider = "prisma-client-js"
}

datasource db {
	provider = "postgresql"
	url      = env("DATABASE_URL")
}

model credentials {
	user_id     				Int      @id @default(autoincrement())
	username     				String
	password     				String
	is_active    				Boolean  @default(true)
	email        				String?
	phone_number 				String?

	created_at   				DateTime @default(now())
	updated_at   				DateTime @default(now()) @updatedAt

	login_history 				login_history[]
	solana_wallet  				solana_wallet[]
}

model login_history {
	login_history_id 			Int       @id @default(autoincrement())
	user_id          			Int
	login_time       			DateTime  @default(now())

	user             			credentials @relation(fields: [user_id], references: [user_id])

	@@index([user_id], name: "login_history__user_id_idx")
}

enum network_type {
	MAINNET
	DEVNET
	TESTNET
}

model solana_wallet {
	solana_wallet_id			Int          @id @default(autoincrement())
	public_key   				String       @db.VarChar(255)
	secret_key   				String       @db.VarChar(255) // Consider storing encrypted!
	user_id      				Int
	network_type 				network_type

	created_at   				DateTime     @default(now())
	updated_at   				DateTime     @default(now()) @updatedAt

	user        				credentials @relation(fields: [user_id], references: [user_id])

	nft_recipient_wallet     	nft_transfer[] @relation("nft_recipient_wallet")
  	nft_sender_wallet    		nft_transfer[] @relation("nft_sender_wallet")
  	nft_transfer_payer_wallet 	nft_transfer[] @relation("nft_transfer_payer_wallet")
	nft_owner_wallet     		nft[] @relation("nft_owner_wallet")
	nft_payer_wallet    		nft[] @relation("nft_payer_wallet")
	spl_payer_wallet			spl[] @relation("spl_payer_wallet")
	spl_transfer_payer_wallet	spl_transfer[] @relation("spl_transfer_payer_wallet")
	spl_mint_payer_wallet		spl_mint[] @relation("spl_mint_payer_wallet")

	nft_ownership 				nft_ownership[]
	token_account 				token_account[]

	@@index([user_id], name: "solana_wallet__user_id_idx")
	@@unique([user_id, network_type])
}

model token_account {
	token_account_id 			Int  @id @default(autoincrement())
	spl_id						Int
	solana_wallet_id    		Int

	created_at    				DateTime  @default(now())
	updated_at    				DateTime  @default(now()) @updatedAt

	SPL       					spl @relation(fields: [spl_id], references: [spl_id])
	solanaWallet       			solana_wallet @relation(fields: [solana_wallet_id], references: [solana_wallet_id])

	spl_ownership				spl_ownership[]
	recipient_token_account     spl_transfer[] @relation("recipient_token_account")
  	sender_token_account    	spl_transfer[] @relation("sender_token_account")
	spl_mint					spl_mint[]

  	@@index([spl_id], name: "token_account__spl_id_idx")
	@@index([solana_wallet_id], name: "token_account__solana_wallet_id_idx")
	@@unique([spl_id, solana_wallet_id])
}

enum NFTListingStatus {
	PRELISTING
	LISTED
	SOLDOUT
	REMOVED
}

model nft {
	nft_id           			Int       @id @default(autoincrement())
	solana_wallet_id       		Int
	meta_data_url  				String
	file_name     				String    // Original name of the file used for the NFT
	nft_name      				String    // Name of the NFT
	chain_address  				String    // Address at which the NFT was minted
	meta_data_address 			String  // On-chain Address of the NFT metaData
	listing_price				Int
	blockchain_mint_fee			Int // Blockchain fee (in dollars)
	payer_solana_wallet_id		Int

	description  				String?   // Description of the NFT
	nft_listing_status 			NFTListingStatus

	created_at    				DateTime  @default(now())
	updated_at    				DateTime  @default(now()) @updatedAt

	nftOwnerWallet				solana_wallet @relation(name: "nft_owner_wallet", fields: [solana_wallet_id], references: [solana_wallet_id])
	nftPayerWallet				solana_wallet @relation(name: "nft_payer_wallet", fields: [payer_solana_wallet_id], references: [solana_wallet_id])

	nft_ownership 				nft_ownership[]
	SPL 						spl[]
	nft_transfer				nft_transfer[]

	@@index([solana_wallet_id], name: "nft__solana_wallet_id_idx")
	@@index([payer_solana_wallet_id], name: "nft_payer_solana_wallet_id_idx")
}

model nft_ownership {
	nft_ownership_id			Int @id @default(autoincrement())
	nft_id 						Int
  	solana_wallet_id    		Int
	// We don't need number_of_shares here since NFT Ownership is singular (only 1 account owns the actual NFT)

	created_at    				DateTime  @default(now())
	updated_at    				DateTime  @default(now()) @updatedAt

	nft         				nft @relation(fields: [nft_id], references: [nft_id])
	solanaWallet       			solana_wallet @relation(fields: [solana_wallet_id], references: [solana_wallet_id])

  	@@index([nft_id], name: "nft_ownership__nft_id_idx")
  	@@index([solana_wallet_id], name: "nft_ownership__solana_wallet_id_idx")
	@@unique([nft_id, solana_wallet_id])
}

model nft_transfer {
	nft_transfer_id 			Int @id @default(autoincrement())
	nft_id						Int
	to_solana_wallet_id			Int
	from_solana_wallet_id 		Int
	blockchain_transfer_fee		Int
	payer_solana_wallet_id		Int

	created_at    				DateTime  @default(now())
	updated_at    				DateTime  @default(now()) @updatedAt

	nft         				nft @relation(fields: [nft_id], references: [nft_id])
  	nft_recipient_wallet   		solana_wallet @relation(name: "nft_recipient_wallet", fields: [to_solana_wallet_id], references: [solana_wallet_id])
	nft_sender_wallet 			solana_wallet @relation(name: "nft_sender_wallet", fields: [from_solana_wallet_id], references: [solana_wallet_id])
	nft_transfer_payer_wallet	solana_wallet @relation(name: "nft_transfer_payer_wallet", fields: [payer_solana_wallet_id], references: [solana_wallet_id])

  	@@index([nft_id], name: "nft_transfer__nft_id_idx")
  	@@index([to_solana_wallet_id], name: "nft_transfer__to_solana_wallet_id_idx")
  	@@index([from_solana_wallet_id], name: "nft_transfer__from_solana_wallet_id_idx")
  	@@index([payer_solana_wallet_id], name: "nft_transfer__payer_solana_wallet_id_idx")
}

model spl {
	spl_id           			Int       @id @default(autoincrement())
	nft_id						Int
	public_key_address			String
	blockchain_mint_fee			Int // Blockchain fee (in dollars)
	payer_solana_wallet_id		Int

	created_at    				DateTime  @default(now())
	updated_at    				DateTime  @default(now()) @updatedAt

	nft         				nft @relation(fields: [nft_id], references: [nft_id])
	spl_payer_wallet			solana_wallet @relation(name: "spl_payer_wallet", fields: [payer_solana_wallet_id], references: [solana_wallet_id])

	spl_ownership 				spl_ownership[]
	spl_transfer 				spl_transfer[]
	token_account				token_account[]
	spl_mint					spl_mint[]

	@@index([nft_id], name: "spl__nft_id_idx")
	@@index([payer_solana_wallet_id], name: "spl__payer_solana_wallet_id_idx")
}

model spl_ownership {
	spl_ownership_id			Int @id @default(autoincrement())
	spl_id 						Int
  	token_account_id    		Int
	number_of_shares			Int

	created_at    				DateTime  @default(now())
	updated_at    				DateTime  @default(now()) @updatedAt

	spl         				spl @relation(fields: [spl_id], references: [spl_id])
	token_account       		token_account @relation(fields: [token_account_id], references: [token_account_id])

  	@@index([spl_id], name: "spl_ownership__spl_id_idx")
  	@@index([token_account_id], name: "spl_ownership__token_account_id_idx")
	@@unique([spl_id, token_account_id])
}

model spl_transfer {
	spl_transfer_id 			Int @id @default(autoincrement())
	spl_id						Int
	recipient_token_account_id	Int
	sender_token_account_id 	Int
	number_of_shares 			Int
	blockchain_mint_fee 		Int
	payer_solana_wallet_id		Int

	created_at    				DateTime  @default(now())
	updated_at    				DateTime  @default(now()) @updatedAt

	spl         				spl @relation(fields: [spl_id], references: [spl_id])
  	recipient_token_account   	token_account @relation(name: "recipient_token_account", fields: [recipient_token_account_id], references: [token_account_id])
	sender_token_account 		token_account @relation(name: "sender_token_account", fields: [sender_token_account_id], references: [token_account_id])
	spl_transfer_payer_wallet	solana_wallet @relation(name: "spl_transfer_payer_wallet", fields: [payer_solana_wallet_id], references: [solana_wallet_id])

  	@@index([spl_id], name: "spl_transfer__spl_id_idx")
  	@@index([recipient_token_account_id], name: "spl_transfer__recipient_token_account_id_idx")
  	@@index([sender_token_account_id], name: "spl_transfer__sender_token_account_id_idx")
  	@@index([payer_solana_wallet_id], name: "spl_transfer__payer_solana_wallet_id_idx")
}

model spl_mint {
	splt_mint_id				Int @id @default(autoincrement())
	spl_id						Int
  	token_account_id    		Int
	number_of_shares			Int
	blockchain_mint_fee 		Int
	payer_solana_wallet_id		Int
	transaction_signature		String

	spl         				spl @relation(fields: [spl_id], references: [spl_id])
	token_account       		token_account @relation(fields: [token_account_id], references: [token_account_id])
	spl_mint_payer_wallet		solana_wallet @relation(name: "spl_mint_payer_wallet", fields: [payer_solana_wallet_id], references: [solana_wallet_id])

  	@@index([spl_id], name: "spl_mint__spl_id_idx")
  	@@index([token_account_id], name: "spl_mint__token_account_id_idx")
  	@@index([payer_solana_wallet_id], name: "spl_mint__payer_solana_wallet_id_idx")
}
