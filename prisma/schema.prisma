generator client {
	provider = "prisma-client-js"
}

datasource db {
	provider = "postgresql"
	url      = env("DATABASE_URL")
}

enum Currencies {
	usd
	sol
}

enum SiteThemes {
	light
	dark
}

enum AuthMethods {
	fortuna
	google
}

model credentials {
	user_id                                                     Int      @id @default(autoincrement())
	username                                                    String?     @unique

	password                                                    String?
	is_active                                                   Boolean  @default(true)
	default_currency                                            Currencies @default(usd)
	default_site_theme                                          SiteThemes @default(light)

	auth_method                                                 AuthMethods

	email__encrypted                                            String?
	phone_number__encrypted                                     String?

	profile_picture_id                                          Int?    @unique
	youtube_access_tokens_id                                    Int?    @unique

	created_at                                                  DateTime @default(now())
	updated_at                                                  DateTime @default(now()) @updatedAt

	login_history                                               login_history[]
	solana_wallet                                               solana_wallet?

	profile_picture                                             profile_picture? @relation(fields: [profile_picture_id], references: [profile_picture_id])
	youtube_access_tokens                                       youtube_access_tokens? @relation(fields: [youtube_access_tokens_id], references: [youtube_access_tokens_id])

	@@index([profile_picture_id], name:"credentials__profile_picture_id_idx")
	@@index([youtube_access_tokens_id], name:"credentials__youtube_access_tokens_id_idx")
}

model login_history {
	login_history_id                                            Int       @id @default(autoincrement())
	user_id                                                     Int
	login_time                                                  DateTime  @default(now())

	user                                                        credentials @relation(fields: [user_id], references: [user_id])

	@@index([user_id], name: "login_history__user_id_idx")
}

model solana_wallet {
	solana_wallet_id                                            Int          @id @default(autoincrement())
	public_key                                                  String       @db.VarChar(255)
	secret_key__encrypted                                       String
	user_id                                                     Int          @unique

	created_at                                                  DateTime     @default(now())
	updated_at                                                  DateTime     @default(now()) @updatedAt

	user                                                        credentials @relation(fields: [user_id], references: [user_id])

	video_creator_wallet                                        video[] @relation("video_creator_wallet")
	exclusive_video_access_purchase                             exclusive_video_access_purchase[]

	sol_transfer_sender_solana_wallet                           sol_transfer[] @relation("sender_solana_wallet")
	sol_transfer_fee_payer_solana_wallet                        sol_transfer[] @relation("fee_payer_solana_wallet")
	sol_transfer_recipient_solana_wallet                        sol_transfer[] @relation("recipient_solana_wallet")

	@@index([user_id], name: "solana_wallet__user_id_idx")
}

enum VideoListingStatus {
	PRELISTING
	LISTED
	SOLDOUT
	REMOVED
}

model video {
	video_id                                                    Int       @id @default(autoincrement())
	video_name                                                  String

	creator_wallet_id                                           Int
	uploaded_image_id                                           Int     @unique
	uploaded_video_id                                           Int     @unique

	uuid                                                        String

	is_video_exclusive                                          Boolean

	video_listing_status                                        VideoListingStatus
	description                                                 String
	is_active                                                   Boolean  @default(true)

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	video_creator_wallet                                        solana_wallet @relation(name: "video_creator_wallet", fields: [creator_wallet_id], references: [solana_wallet_id])
	uploaded_image                                              uploaded_image @relation(fields: [uploaded_image_id], references: [uploaded_image_id])
	uploaded_video                                              uploaded_video @relation(fields: [uploaded_video_id], references: [uploaded_video_id])

	exclusive_video_access_purchase                             exclusive_video_access_purchase[]
	video_access_tier                                           video_access_tier[]

	@@index([creator_wallet_id], name: "video__creator_wallet_id_idx")
	@@index([uploaded_image_id], name: "video__uploaded_image_id_idx")
}

model video_access_tier {
	video_access_tier_id                                        Int  @id @default(autoincrement())
	video_id                                                    Int
	tier_number                                                 Int // ie. 1, 2, 3.
	purchases_allowed_for_this_tier                             Int?
	percent_discount_at_this_tier                               Float
	tier_access_price_usd										Float
	is_sold_out													Boolean @default(false)

	video                                                       video @relation(fields: [video_id], references: [video_id])

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	@@index([video_id], name: "video_access_tiers__video_id_idx")
	@@unique([video_id, tier_number])
}

model exclusive_video_access_purchase {
	exclusive_video_access_purchase_id                          Int  @id @default(autoincrement())
	video_id                                                    Int
	solana_wallet_id                                            Int
	sol_transfer_id                                             Int     @unique
	video_access_tier_number									Int

	video                                                       video @relation(fields: [video_id], references: [video_id])
	solana_wallet                                               solana_wallet @relation(fields: [solana_wallet_id], references: [solana_wallet_id])
	sol_transfer                                                sol_transfer   @relation(fields: [sol_transfer_id], references: [sol_transfer_id])

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	@@index([video_id], name: "exclusive_video_access_purchase__video_id_idx")
	@@index([solana_wallet_id], name: "exclusive_video_access_purchase__solana_wallet_id_idx")
	@@index([sol_transfer_id], name: "exclusive_video_access_purchase__sol_transfer_id_idx")
	@@unique([video_id, solana_wallet_id])
}

model uploaded_image {
	uploaded_image_id                                           Int @id @default(autoincrement())
	image_url                                                   String
	file_name                                                   String

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	video                                                       video?
}

model uploaded_video {          
	uploaded_video_id                                           Int @id @default(autoincrement())
	file_name                                                   String

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	video                                                       video?
}

model sol_transfer {            
	sol_transfer_id                                             Int @id @default(autoincrement())
	recipient_public_key                                        String       @db.VarChar(255)
	recipient_solana_wallet_id                                  Int?
	is_recipient_fortuna_wallet                                 Boolean
	transaction_signature                                       String
	is_exclusive_video_access_purchase                          Boolean

	sol_amount_transferred                                      Float
	usd_amount_transferred                                      Float
	transfer_by_currency                                        Currencies

	transfer_fee_sol                                            Float
	transfer_fee_usd                                            Float

	sender_solana_wallet_id                                     Int
	fee_payer_solana_wallet_id                                  Int

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	sender_solana_wallet                                        solana_wallet @relation(name: "sender_solana_wallet", fields: [sender_solana_wallet_id], references: [solana_wallet_id])
	recipient_solana_wallet                                     solana_wallet? @relation(name: "recipient_solana_wallet", fields: [recipient_solana_wallet_id], references: [solana_wallet_id])
	fee_payer_solana_wallet                                     solana_wallet @relation(name: "fee_payer_solana_wallet", fields: [fee_payer_solana_wallet_id], references: [solana_wallet_id])

	exclusive_video_access_purchase                             exclusive_video_access_purchase?

	@@index([sender_solana_wallet_id], name: "sol_transfer__sender_solana_wallet_id_idx")
	@@index([recipient_solana_wallet_id], name: "sol_transfer__recipient_solana_wallet_id_idx")
	@@index([fee_payer_solana_wallet_id], name: "sol_transfer__fee_payer_solana_wallet_id_idx")
}

model profile_picture {
	profile_picture_id                                          Int @id @default(autoincrement())
	image_url                                                   String
	file_name                                                   String
	uuid                                                        String

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	user                                                        credentials?
}

model youtube_access_tokens {           
	youtube_access_tokens_id                                    Int @id @default(autoincrement())
	access_token                                                String
	refresh_token__encrypted                                    String
	expiry_date                                                 DateTime

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	user                                                        credentials?
}
