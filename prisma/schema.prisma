generator client {
	provider = "prisma-client-js"
}

datasource db {
	provider = "postgresql"
	url      = env("DATABASE_URL")
}

enum Currencies {
	usd
	sol
}

enum SiteThemes {
	light
	dark
}

enum AuthMethods {
	fortuna
	google
}

model credentials {
	user_id                                                     Int      @id @default(autoincrement())
	username                                                    String?     @unique

	password                                                    String?
	is_active                                                   Boolean  @default(true)
	default_currency                                            Currencies @default(usd)
	default_site_theme                                          SiteThemes @default(light)

	auth_method                                                 AuthMethods

	email__encrypted                                            String

	profile_picture_id                                          Int?    @unique
	youtube_access_tokens_id                                    Int?    @unique
	channel_banner_id                                          	Int?    @unique

	created_at                                                  DateTime @default(now())
	updated_at                                                  DateTime @default(now()) @updatedAt

	login_history                                               login_history[]
	solana_wallet                                               solana_wallet?
	video_like_status											video_like_status[]
	video				                                        video[]
	video_tag_lookup				                            video_tag_lookup[]
	reported_video				                            	reported_video[]

	exclusive_video_access_purchase                             exclusive_video_access_purchase[]
	channel_name												channel_name?
	channel_description											channel_description?
	social_platform_link										social_platform_link[]

	profile_picture                                             profile_picture? @relation(fields: [profile_picture_id], references: [profile_picture_id])
	channel_banner	                                            channel_banner? @relation(fields: [channel_banner_id], references: [channel_banner_id])
	youtube_access_tokens                                       youtube_access_tokens? @relation(fields: [youtube_access_tokens_id], references: [youtube_access_tokens_id])

	@@index([profile_picture_id], name:"credentials__profile_picture_id_idx")
	@@index([channel_banner_id], name:"credentials__channel_banner_id_idx")
	@@index([youtube_access_tokens_id], name:"credentials__youtube_access_tokens_id_idx")
}

model login_history {
	login_history_id                                            Int       @id @default(autoincrement())
	user_id                                                     Int
	login_time                                                  DateTime  @default(now())

	user                                                        credentials @relation(fields: [user_id], references: [user_id])

	@@index([user_id], name: "login_history__user_id_idx")
}

model solana_wallet {
	solana_wallet_id                                            Int          @id @default(autoincrement())
	public_key                                                  String       @db.VarChar(255)
	secret_key__encrypted                                       String
	user_id                                                     Int          @unique

	created_at                                                  DateTime     @default(now())
	updated_at                                                  DateTime     @default(now()) @updatedAt

	user                                                        credentials @relation(fields: [user_id], references: [user_id])

	sol_transfer_sender_solana_wallet                           sol_transfer[] @relation("sender_solana_wallet")
	sol_transfer_recipient_solana_wallet                        sol_transfer[] @relation("recipient_solana_wallet")
	sol_transfer_fortuna_wallet_fee_payer			            blockchain_fees_paid_by_fortuna[]
	sol_transfer_user_payer_solana_wallet                       blockchain_fees_paid_by_user[]

	fortuna_take_sender_solana_wallet                        	exclusive_video_access_purchase_fortuna_take[] @relation("fortuna_take_sender_solana_wallet")
	fortuna_take_recipient_solana_wallet                        exclusive_video_access_purchase_fortuna_take[] @relation("fortuna_take_recipient_solana_wallet")

	fan_solana_wallet											exclusive_video_access_purchase_sol_transfer[] @relation("fan_solana_wallet")
	content_creator_solana_wallet								exclusive_video_access_purchase_sol_transfer[] @relation("content_creator_solana_wallet")

	@@index([user_id], name: "solana_wallet__user_id_idx")
}

enum VideoListingStatus {
	LISTED
	UNLISTED
	SOLDOUT
}

model video {
	video_id                                                    Int       @id @default(autoincrement())
	video_name                                                  String

	creator_user_id                                           	Int
	uploaded_image_id                                           Int     @unique
	uploaded_video_id                                           Int     @unique

	uuid                                                        String

	is_video_exclusive                                          Boolean

	video_listing_status                                        VideoListingStatus
	description                                                 String
	is_video_featured											Boolean @default(false)

	is_active                                                   Boolean  @default(true)

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	exclusive_video_access_purchase                             exclusive_video_access_purchase[]
	video_access_tier                                           video_access_tier[]
	video_like_status											video_like_status[]
	video_tag_mapping											video_tag_mapping[]
	reported_video												reported_video[]

	video_creator		                                        credentials @relation(fields: [creator_user_id], references: [user_id])
	uploaded_image                                              uploaded_image @relation(fields: [uploaded_image_id], references: [uploaded_image_id])
	uploaded_video                                              uploaded_video @relation(fields: [uploaded_video_id], references: [uploaded_video_id])

	@@index([creator_user_id], name: "video__creator_user_id_idx")
	@@index([uploaded_image_id], name: "video__uploaded_image_id_idx")
	@@index([uploaded_video_id], name: "video__uploaded_video_id_idx")
}

model video_tag_lookup {
	video_tag_lookup_id                                         Int  @id @default(autoincrement())
	video_tag													String @unique
	added_by_user_id											Int

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	video_tag_mapping											video_tag_mapping[]
	user                                               			credentials @relation(fields: [added_by_user_id], references: [user_id])

	@@index([added_by_user_id], name: "video_tag_lookup__added_by_user_id_idx")
}

model video_tag_mapping {
	video_tag_mapping_id                                        Int  @id @default(autoincrement())
	video_tag_lookup_id											Int
	video_id													Int

	is_active                                                   Boolean  @default(true)

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	video_tag_lookup                                   			video_tag_lookup @relation(fields: [video_tag_lookup_id], references: [video_tag_lookup_id])
	video                                              			video @relation(fields: [video_id], references: [video_id])

	@@index([video_tag_lookup_id], name: "video_tag_mapping__video_tag_lookup_id_idx")
	@@index([video_id], name: "video_tag_mapping__video_id_idx")
	@@unique([video_tag_lookup_id, video_id])
}

model video_access_tier {
	video_access_tier_id                                        Int  @id @default(autoincrement())
	video_id                                                    Int
	tier_number                                                 Int // ie. 1, 2, 3.
	tier_access_price_usd										Float
	purchases_allowed_for_this_tier                             Int?
	is_sold_out													Boolean @default(false)

	video                                                       video @relation(fields: [video_id], references: [video_id])

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	@@index([video_id], name: "video_access_tiers__video_id_idx")
	@@unique([video_id, tier_number])
}

model exclusive_video_access_purchase {
	exclusive_video_access_purchase_id                          Int  @id @default(autoincrement())
	video_id                                                    Int
	user_id			                                            Int
	video_access_tier_number									Int
	exclusive_video_access_purchase_sol_transfer_id             Int @unique(map: "unique_sol_transfer_id")
	exclusive_video_access_purchase_fortuna_take_id             Int @unique(map: "unique_fortuna_take_id")

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	video                                                       video @relation(fields: [video_id], references: [video_id])
	user                                               			credentials @relation(fields: [user_id], references: [user_id])
	exclusive_video_access_purchase_sol_transfer                exclusive_video_access_purchase_sol_transfer @relation(fields: [exclusive_video_access_purchase_sol_transfer_id], references: [exclusive_video_access_purchase_sol_transfer_id], map: "exclusive_video_access_purchase_sol_transfer_fkey")
	exclusive_video_access_purchase_fortuna_take                exclusive_video_access_purchase_fortuna_take @relation(fields: [exclusive_video_access_purchase_fortuna_take_id], references: [exclusive_video_access_purchase_fortuna_take_id], map: "exclusive_video_access_purchase_fortuna_take_fkey")

	@@index([video_id], name: "exclusive_video_access_purchase__video_id_idx")
	@@index([user_id], name: "exclusive_video_access_purchase__user_id_idx")
	@@index([exclusive_video_access_purchase_sol_transfer_id], name: "exclusive_video_access__sol_transfer_id_idx")
	@@index([exclusive_video_access_purchase_fortuna_take_id], name: "exclusive_video_access__take_id_idx")
	@@unique([video_id, user_id])
}

model uploaded_image {
	uploaded_image_id                                           Int @id @default(autoincrement())
	image_url                                                   String
	file_name                                                   String
	video_id													Int?

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	video                                                       video?
}

model uploaded_video {
	uploaded_video_id                                           Int @id @default(autoincrement())
	file_name                                                   String
	video_duration_seconds										Float
	video_id													Int?

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	video                                                       video?
}

model sol_transfer {
	sol_transfer_id                                             Int @id @default(autoincrement())
	recipient_public_key                                        String       @db.VarChar(255)
	recipient_solana_wallet_id                                  Int?
	is_recipient_fortuna_wallet                                 Boolean
	transaction_signature                                       String

	sol_amount_transferred                                      Float
	usd_amount_transferred                                      Float
	transfer_by_currency                                        Currencies

	sender_solana_wallet_id                                     Int
	blockchain_fees_paid_by_fortuna_id							Int? @unique
	blockchain_fees_paid_by_user_id								Int? @unique

	sender_new_wallet_balance_sol								Float?
	sender_new_wallet_balance_usd								Float?
	recipient_new_wallet_balance_sol							Float?
	recipient_new_wallet_balance_usd							Float?

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	sender_solana_wallet                                        solana_wallet @relation(name: "sender_solana_wallet", fields: [sender_solana_wallet_id], references: [solana_wallet_id])
	recipient_solana_wallet                                     solana_wallet? @relation(name: "recipient_solana_wallet", fields: [recipient_solana_wallet_id], references: [solana_wallet_id])
	blockchain_fee_paid_by_fortuna								blockchain_fees_paid_by_fortuna? @relation(fields: [blockchain_fees_paid_by_fortuna_id], references: [blockchain_fees_paid_by_fortuna_id])
	blockchain_fees_paid_by_user								blockchain_fees_paid_by_user? @relation(fields: [blockchain_fees_paid_by_user_id], references: [blockchain_fees_paid_by_user_id])

	@@index([sender_solana_wallet_id], name: "sol_transfer__sender_solana_wallet_id_idx")
	@@index([recipient_solana_wallet_id], name: "sol_transfer__recipient_solana_wallet_id_idx")
	@@index([blockchain_fees_paid_by_fortuna_id], name: "sol_transfer__blockchain_fees_paid_by_fortuna_id_idx")
	@@index([blockchain_fees_paid_by_user_id], name: "sol_transfer__blockchain_fees_paid_by_user_id_idx")
}

model exclusive_video_access_purchase_sol_transfer {
	exclusive_video_access_purchase_sol_transfer_id             Int @id @default(autoincrement())
	fan_solana_wallet_id          	                            Int
	content_creator_solana_wallet_id                            Int
	transaction_signature                                       String

	sol_amount_transferred                                      Float
	usd_amount_transferred                                      Float

	blockchain_fees_paid_by_fortuna_id							Int @unique

	sender_new_wallet_balance_sol								Float?
	sender_new_wallet_balance_usd								Float?
	recipient_new_wallet_balance_sol							Float?
	recipient_new_wallet_balance_usd							Float?

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	fan_solana_wallet                     		                solana_wallet @relation(name: "fan_solana_wallet", fields: [fan_solana_wallet_id], references: [solana_wallet_id])
	content_creator_solana_wallet                               solana_wallet @relation(name: "content_creator_solana_wallet", fields: [content_creator_solana_wallet_id], references: [solana_wallet_id])
	blockchain_fee_paid_by_fortuna								blockchain_fees_paid_by_fortuna @relation(fields: [blockchain_fees_paid_by_fortuna_id], references: [blockchain_fees_paid_by_fortuna_id])

	exclusive_video_access_purchase                             exclusive_video_access_purchase?

	@@index([fan_solana_wallet_id], name: "exc_vid_purchase_sol_transfer__fan_solana_wallet_id_idx")
	@@index([content_creator_solana_wallet_id], name: "exc_vid_purchase__content_creator_solana_wallet_id_idx")
	@@index([blockchain_fees_paid_by_fortuna_id], name: "exc_vid_purchase__blockchain_fees_paid_by_fortuna_id_idx")
}

model exclusive_video_access_purchase_fortuna_take {
	exclusive_video_access_purchase_fortuna_take_id				Int @id @default(autoincrement())
	sender_solana_wallet_id										Int
	fortuna_recipient_solana_wallet_id							Int
	transaction_signature                                       String

	sol_amount_transferred                                      Float
	usd_amount_transferred                                      Float

	blockchain_fees_paid_by_fortuna_id							Int @unique

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	sender_solana_wallet                                        solana_wallet @relation(name: "fortuna_take_sender_solana_wallet", fields: [sender_solana_wallet_id], references: [solana_wallet_id])
	fortuna_recipient_solana_wallet								solana_wallet @relation(name: "fortuna_take_recipient_solana_wallet", fields: [fortuna_recipient_solana_wallet_id], references: [solana_wallet_id])
	blockchain_fee_paid_by_fortuna								blockchain_fees_paid_by_fortuna @relation(fields: [blockchain_fees_paid_by_fortuna_id], references: [blockchain_fees_paid_by_fortuna_id])
	exclusive_video_access_purchase								exclusive_video_access_purchase?

	@@index([sender_solana_wallet_id], name: "fortuna_take__sender_solana_wallet_id_idx")
	@@index([fortuna_recipient_solana_wallet_id], name: "fortuna_take__fortuna_recipient_solana_wallet_id_idx")
	@@index([blockchain_fees_paid_by_fortuna_id], name: "fortuna_take__blockchain_fees_paid_by_fortuna_id_idx")
}

model blockchain_fees_paid_by_fortuna {
	blockchain_fees_paid_by_fortuna_id							Int @id @default(autoincrement())

	fee_in_sol                                            		Float?
	fee_in_usd                                            		Float?

	fee_payer_solana_wallet_id                                  Int

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	fee_payer_solana_wallet                                     solana_wallet @relation(fields: [fee_payer_solana_wallet_id], references: [solana_wallet_id])
	exclusive_video_access_purchase_fortuna_take				exclusive_video_access_purchase_fortuna_take?
	sol_transfer												sol_transfer?
	exclusive_video_access_purchase_sol_transfer				exclusive_video_access_purchase_sol_transfer?

	@@index([fee_payer_solana_wallet_id], name: "blockchain_fees_paid_by_fortuna__fee_payer_solana_wallet_idx")
}

model blockchain_fees_paid_by_user {
	blockchain_fees_paid_by_user_id								Int @id @default(autoincrement())

	fee_in_sol                                            		Float?
	fee_in_usd                                            		Float?

	fee_payer_solana_wallet_id                                  Int

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	fee_payer_solana_wallet                                     solana_wallet @relation(fields: [fee_payer_solana_wallet_id], references: [solana_wallet_id])
	sol_transfer												sol_transfer?

	@@index([fee_payer_solana_wallet_id], name: "blockchain_fees_paid_by_user__fee_payer_solana_wallet_idx")
}

model profile_picture {
	profile_picture_id                                          Int @id @default(autoincrement())
	image_url                                                   String
	file_name                                                   String
	uuid                                                        String
  	user_id             										Int    @unique

	is_active                                                   Boolean  @default(true)

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	user                                                        credentials?
}

model youtube_access_tokens {
	youtube_access_tokens_id                                    Int @id @default(autoincrement())
	access_token                                                String
	refresh_token__encrypted                                    String
	expiry_date                                                 DateTime

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	user                                                        credentials?
}

model video_like_status {
	video_like_status_id										Int @id @default(autoincrement())
	video_id													Int
	user_id														Int

	is_active                                                   Boolean  @default(true)

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	video                                                       video @relation(fields: [video_id], references: [video_id])
	user                                                        credentials @relation(fields: [user_id], references: [user_id])

	@@index([video_id], name: "video_like_status__video_id_idx")
	@@index([user_id], name: "video_like_status__user_id_idx")
	@@unique([video_id, user_id])
}

model channel_name {
	channel_name_id												Int @id @default(autoincrement())
	user_id														Int @unique()
	channel_name												String

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	user                                                        credentials @relation(fields: [user_id], references: [user_id])

	@@index([user_id], name: "channel_name__user_id_idx")
}

model channel_description {
	channel_description_id										Int @id @default(autoincrement())
	user_id														Int @unique()
	channel_description											String

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	user                                                        credentials @relation(fields: [user_id], references: [user_id])

	@@index([user_id], name: "channel_description__user_id_idx")
}

enum SocialPlatforms {
	youtube
	twitter
	twitch
	spotify
	soundcloud
	applemusic
	instagram
	facebook
	tiktok
}

model social_platform_link {
	social_platform_link_id										Int @id @default(autoincrement())
	user_id														Int
	social_link													String
	social_platform												SocialPlatforms

	is_active                                                   Boolean  @default(true)

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	user                                                        credentials @relation(fields: [user_id], references: [user_id])

	@@index([user_id], name: "social_platform_link__user_id_idx")
	@@unique([user_id, social_platform])
}

model channel_banner {
	channel_banner_id                                          	Int @id @default(autoincrement())
	image_url                                                   String
	file_name                                                   String
	uuid                                                        String
  	user_id             										Int    @unique

	is_active                                                   Boolean  @default(true)

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	user                                                        credentials?
}

model reported_video {
	reported_video_id											Int @id @default(autoincrement())
	video_id													Int
	user_id_who_reported_video									Int
	report_message												String?

	is_active                                                   Boolean  @default(true)

	created_at                                                  DateTime  @default(now())
	updated_at                                                  DateTime  @default(now()) @updatedAt

	video                                              			video @relation(fields: [video_id], references: [video_id])
	user                                               			credentials @relation(fields: [user_id_who_reported_video], references: [user_id])

	@@index([video_id], name: "reported_video__video_id_idx")
	@@index([user_id_who_reported_video], name: "reported_video__user_id_who_reported_video_idx")
	@@unique([video_id, user_id_who_reported_video])
}
